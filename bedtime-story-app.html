<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­æ–‡ç¡å‰æ•…äº‹ç”Ÿæˆå™¨</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        
        // Simple icon components using Unicode symbols
        const Sparkles = () => React.createElement('span', null, 'âœ¨');
        const Book = () => React.createElement('span', null, 'ğŸ“–');
        const ArrowRight = ({ className }) => React.createElement('span', { className }, 'â†’');
        const ArrowLeft = ({ className }) => React.createElement('span', { className }, 'â†');
        const Loader2 = ({ className }) => React.createElement('span', { className: className + ' inline-block animate-spin' }, 'âŸ³');
        const Heart = () => React.createElement('span', null, 'â¤ï¸');
        const Star = () => React.createElement('span', null, 'â­');
        const Eye = () => React.createElement('span', null, 'ğŸ‘ï¸');
        const EyeOff = () => React.createElement('span', null, 'ğŸ™ˆ');

        const ChineseBedtimeStoryGenerator = () => {
            const [currentStep, setCurrentStep] = useState(0);
            const [isGenerating, setIsGenerating] = useState(false);
            const [storyData, setStoryData] = useState(null);
            const [showPinyin, setShowPinyin] = useState(true);
            const [showZhuyin, setShowZhuyin] = useState(true);
            const [formData, setFormData] = useState({
                age: '',
                gender: '',
                interests: [],
                length: '',
                lesson: ''
            });
            const apiKey = 'AIzaSyCXHNhEOwcqK4Xf4zPFPIjpW2pf7L2xr0w';

            const interests = [
                'å‹•ç‰©', 'å¤ªç©ºèˆ‡æ˜Ÿæ˜Ÿ', 'æµ·æ´‹ç”Ÿç‰©', 'æé¾', 'é­”æ³•å¹»æƒ³',
                'é‹å‹•', 'éŸ³æ¨‚', 'è—è¡“ç¹ªç•«', 'è‡ªç„¶æ£®æ—', 'è¶…ç´šè‹±é›„',
                'äº¤é€šå·¥å…·', 'çƒ¹é£ªç¾é£Ÿ', 'ç§‘å­¸å¯¦é©—'
            ];

            const storyLengths = [
                { value: 'short', label: 'çŸ­ç¯‡æ•…äº‹', emoji: 'ğŸ“–', desc: '5-8å¥è©±', chars: '50-100å­—' },
                { value: 'medium', label: 'ä¸­ç¯‡æ•…äº‹', emoji: 'ğŸ“š', desc: '10-15å¥è©±', chars: '150-250å­—' },
                { value: 'long', label: 'é•·ç¯‡æ•…äº‹', emoji: 'ğŸ“œ', desc: '20-30å¥è©±', chars: '300-500å­—' }
            ];

            const handleInterestToggle = (interest) => {
                setFormData(prev => ({
                    ...prev,
                    interests: prev.interests.includes(interest)
                        ? prev.interests.filter(i => i !== interest)
                        : [...prev.interests, interest]
                }));
            };

            const nextStep = () => {
                setCurrentStep(currentStep + 1);
            };

            const prevStep = () => {
                setCurrentStep(currentStep - 1);
            };

            const generateStory = async () => {
                setIsGenerating(true);
                setCurrentStep(5);

                try {
                    const lengthSpecs = {
                        short: '5-8å¥è©±ï¼Œå¤§ç´„50-100å€‹ä¸­æ–‡å­—',
                        medium: '10-15å¥è©±ï¼Œå¤§ç´„150-250å€‹ä¸­æ–‡å­—', 
                        long: '20-30å¥è©±ï¼Œå¤§ç´„300-500å€‹ä¸­æ–‡å­—'
                    };

                    const prompt = `è«‹ç‚ºä¸€å€‹${formData.age}æ­²çš„${formData.gender}å‰µä½œä¸€å€‹ä¸­æ–‡ç¡å‰æ•…äº‹ï¼Œä¸»é¡ŒåŒ…å«${formData.interests.join('ã€')}ã€‚

æ•…äº‹è¦æ±‚ï¼š
- é•·åº¦ï¼š${lengthSpecs[formData.length]}
- æ•™å°çš„å“å¾·ï¼š${formData.lesson}
- é©åˆç¡å‰é–±è®€ï¼ˆå¹³éœçš„çµå±€ï¼‰
- èªè¨€é©åˆå…’ç«¥ç†è§£
- ç”¨è©ç°¡å–®ï¼Œå¥å­ä¸è¦å¤ªè¤‡é›œ

è«‹ä»¥JSONæ ¼å¼å›è¦†ï¼ŒåŒ…å«ä»¥ä¸‹æ ¼å¼ï¼š
{
  "title": "æ•…äº‹æ¨™é¡Œ",
  "story": [
    {
      "chinese": "ä¸­æ–‡å¥å­",
      "hanyu_pinyin": "æ¼¢èªæ‹¼éŸ³æ¨™è¨»",
      "zhuyin": "æ³¨éŸ³æ¨™è¨»"
    }
  ]
}

æ³¨æ„ï¼š
- æ¯å€‹å¥å­éƒ½è¦æä¾›æº–ç¢ºçš„æ¼¢èªæ‹¼éŸ³å’Œæ³¨éŸ³
- æ¼¢èªæ‹¼éŸ³ä½¿ç”¨æ¨™æº–è²èª¿ç¬¦è™Ÿ
- æ³¨éŸ³ä½¿ç”¨æ­£ç¢ºçš„ã„…ã„†ã„‡ã„ˆç³»çµ±
- ç¢ºä¿æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼
- ä¸è¦åŒ…å«ä»»ä½•å…¶ä»–æ–‡å­—ï¼Œåªè¦JSON

DO NOT OUTPUT ANYTHING OTHER THAN VALID JSON. DON'T INCLUDE LEADING BACKTICKS LIKE \`\`\`json.`;

                    // API key is hardcoded, no need to check

                    // Try direct API call first, then fallback to alternative methods
                    let response;
                    try {
                        // Method 1: Direct API call with proper headers
                        response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [{
                                        text: prompt
                                    }]
                                }],
                                generationConfig: {
                                    temperature: 0.7,
                                    topK: 40,
                                    topP: 0.95,
                                    maxOutputTokens: 2048,
                                },
                                safetySettings: [
                                    {
                                        category: "HARM_CATEGORY_HARASSMENT",
                                        threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                    },
                                    {
                                        category: "HARM_CATEGORY_HATE_SPEECH",
                                        threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                    },
                                    {
                                        category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                                        threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                    },
                                    {
                                        category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                                        threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                    }
                                ]
                            })
                        });
                    } catch (corsError) {
                        console.log('Direct API call failed, trying alternative method:', corsError);
                        // Method 2: Use a different CORS proxy
                        try {
                            response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`)}`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    contents: [{
                                        parts: [{
                                            text: prompt
                                        }]
                                    }],
                                    generationConfig: {
                                        temperature: 0.7,
                                        topK: 40,
                                        topP: 0.95,
                                        maxOutputTokens: 2048
                                    }
                                })
                            });
                        } catch (proxyError) {
                             console.log('Proxy method also failed, trying local proxy:', proxyError);
                             // Method 3: Use local proxy server (if running)
                             try {
                                 response = await fetch('http://localhost:3001/api/gemini', {
                                     method: 'POST',
                                     headers: {
                                         'Content-Type': 'application/json'
                                     },
                                     body: JSON.stringify({
                                         apiKey: apiKey,
                                         contents: [{
                                             parts: [{ text: prompt }]
                                         }],
                                         generationConfig: {
                                             temperature: 0.7,
                                             topK: 40,
                                             topP: 0.95,
                                             maxOutputTokens: 2048
                                         },
                                         safetySettings: [
                                             {
                                                 category: "HARM_CATEGORY_HARASSMENT",
                                                 threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                             },
                                             {
                                                 category: "HARM_CATEGORY_HATE_SPEECH",
                                                 threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                             },
                                             {
                                                 category: "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                                                 threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                             },
                                             {
                                                 category: "HARM_CATEGORY_DANGEROUS_CONTENT",
                                                 threshold: "BLOCK_MEDIUM_AND_ABOVE"
                                             }
                                         ]
                                     })
                                 });
                             } catch (localProxyError) {
                                 console.log('Local proxy also failed:', localProxyError);
                                 throw new Error('æ‰€æœ‰APIèª¿ç”¨æ–¹æ³•éƒ½å¤±æ•—äº†ã€‚è«‹æª¢æŸ¥ç¶²è·¯é€£æ¥ã€APIé‡‘é‘°ï¼Œæˆ–é‹è¡Œæœ¬åœ°ä»£ç†æœå‹™å™¨ã€‚');
                             }
                         }
                    }

                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('API Error Response:', errorText);
                        throw new Error(`APIè«‹æ±‚å¤±æ•— (${response.status}): ${errorText}`);
                    }

                    const data = await response.json();
                    console.log('API Response:', data);
                    
                    if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                        console.error('Invalid API response structure:', data);
                        throw new Error('APIè¿”å›çš„æ•¸æ“šæ ¼å¼ä¸æ­£ç¢º');
                    }
                    
                    const generatedText = data.candidates[0].content.parts[0].text;
                    console.log('Generated text:', generatedText);
                    
                    // Clean up the response to extract JSON
                    let cleanedText = generatedText.trim();
                    if (cleanedText.startsWith('```json')) {
                        cleanedText = cleanedText.replace(/^```json\s*/, '').replace(/\s*```$/, '');
                    }
                    if (cleanedText.startsWith('```')) {
                        cleanedText = cleanedText.replace(/^```\s*/, '').replace(/\s*```$/, '');
                    }
                    
                    console.log('Cleaned text for parsing:', cleanedText);
                    const parsedStory = JSON.parse(cleanedText);
                    setStoryData(parsedStory);
                    setCurrentStep(6);
                } catch (error) {
                    console.error('Error generating story:', error);
                    let errorMessage = 'æŠ±æ­‰ï¼Œç”Ÿæˆæ•…äº‹æ™‚å‡ºç¾éŒ¯èª¤ã€‚';
                    
                    if (error.message.includes('APIè«‹æ±‚å¤±æ•—')) {
                        errorMessage += '\n\nå¯èƒ½çš„åŸå› ï¼š\nâ€¢ APIé‡‘é‘°ç„¡æ•ˆæˆ–å·²éæœŸ\nâ€¢ ç¶²è·¯é€£æ¥å•é¡Œ\nâ€¢ APIæœå‹™æš«æ™‚ä¸å¯ç”¨';
                    } else if (error.message.includes('JSON')) {
                        errorMessage += '\n\næ•…äº‹å…§å®¹è§£æå¤±æ•—ï¼Œè«‹é‡è©¦ã€‚';
                    } else if (error.message.includes('APIè¿”å›çš„æ•¸æ“šæ ¼å¼ä¸æ­£ç¢º')) {
                        errorMessage += '\n\nAPIè¿”å›äº†æ„å¤–çš„éŸ¿æ‡‰æ ¼å¼ã€‚';
                    } else if (error.message.includes('CORS') || error.message.includes('fetch')) {
                        errorMessage += '\n\né€™å¯èƒ½æ˜¯CORSè·¨åŸŸå•é¡Œã€‚\n\nè§£æ±ºæ–¹æ¡ˆï¼š\nâ€¢ ä½¿ç”¨Chromeç€è¦½å™¨ä¸¦å®‰è£CORSæ“´å±•\nâ€¢ æˆ–è€…åœ¨æœ¬åœ°é‹è¡Œä¸€å€‹ä»£ç†æœå‹™å™¨\nâ€¢ æˆ–è€…ä½¿ç”¨æ”¯æŒCORSçš„ç€è¦½å™¨è¨­ç½®';
                    }
                    
                    errorMessage += '\n\nè«‹æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°ä»¥ç²å–è©³ç´°éŒ¯èª¤ä¿¡æ¯ï¼Œç„¶å¾Œé‡è©¦ã€‚';
                    
                    alert(errorMessage);
                    setCurrentStep(4);
                } finally {
                    setIsGenerating(false);
                }
            };

            const resetForm = () => {
                setCurrentStep(0);
                setStoryData(null);
                setIsGenerating(false);
                setFormData({
                    age: '',
                    gender: '',
                    interests: [],
                    length: '',
                    lesson: ''
                });
            };

            const canProceed = () => {
                switch (currentStep) {
                    case 0: return formData.age !== '';
                    case 1: return formData.gender !== '';
                    case 2: return formData.interests.length > 0;
                    case 3: return formData.length !== '';
                    case 4: return formData.lesson.trim() !== '';
                    default: return true;
                }
            };

            const getStepTitle = () => {
                const titles = [
                    'æ‚¨çš„å­©å­å¹¾æ­²ï¼Ÿ',
                    'å‘Šè¨´æˆ‘å€‘é—œæ–¼æ‚¨çš„å­©å­',
                    'æ‚¨çš„å­©å­å–œæ­¡ä»€éº¼ï¼Ÿ',
                    'æ•…äº‹é•·åº¦',
                    'æƒ³è¦å­¸ç¿’ä»€éº¼å“å¾·ï¼Ÿ',
                    'æ­£åœ¨å‰µä½œæ‚¨çš„æ•…äº‹...',
                    'æ‚¨çš„ä¸­æ–‡ç¡å‰æ•…äº‹æº–å‚™å¥½äº†ï¼'
                ];
                return titles[currentStep];
            };

            const getStepSubtitle = () => {
                const subtitles = [
                    'é€™å¹«åŠ©æˆ‘å€‘é¸æ“‡é©åˆçš„è©å½™å’Œä¸»é¡Œ',
                    'æˆ‘å€‘æœƒä½¿ç”¨æ­£ç¢ºçš„ç¨±è¬‚å’Œè¦–è§’',
                    'é¸æ“‡1-3å€‹æ¿€ç™¼æƒ³åƒåŠ›çš„ä¸»é¡Œ',
                    'é¸æ“‡é©åˆçš„æ•…äº‹é•·åº¦',
                    'æ•…äº‹ä¸­æ‡‰è©²åŒ…å«ä»€éº¼é‡è¦è¨Šæ¯ï¼Ÿ',
                    'æˆ‘å€‘çš„æ•…äº‹é­”æ³•æ­£åœ¨é‹ä½œ...',
                    'ç”œç¾çš„å¤¢å¢ƒå°±åœ¨ä¸€å€‹æ•…äº‹ä¹‹å¤–ï¼'
                ];
                return subtitles[currentStep];
            };

            // Step 0: Age
            if (currentStep === 0) {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-red-100 via-orange-50 to-yellow-100 flex items-center justify-center p-4" },
                    React.createElement('div', { className: "bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full border-2 border-red-200" },
                        React.createElement('div', { className: "text-center mb-8" },
                            React.createElement('div', { className: "flex justify-center mb-4" },
                                React.createElement('div', { className: "text-4xl" }, 'ğŸ®')
                            ),
                            React.createElement('h1', { className: "text-3xl font-bold text-gray-800 mb-2" }, getStepTitle()),
                            React.createElement('p', { className: "text-gray-600" }, getStepSubtitle())
                        ),
                        React.createElement('div', { className: "space-y-6" },
                            React.createElement('input', {
                                type: "number",
                                value: formData.age,
                                onChange: (e) => setFormData({...formData, age: e.target.value}),
                                placeholder: "è¼¸å…¥å¹´é½¡ (1-6)",
                                min: "1",
                                max: "6",
                                className: "w-full px-6 py-4 border-2 border-gray-200 rounded-2xl focus:border-red-500 focus:outline-none transition-colors text-2xl text-center font-bold",
                                autoFocus: true
                            }),
                            React.createElement('button', {
                                onClick: nextStep,
                                disabled: !canProceed(),
                                className: "w-full bg-gradient-to-r from-red-500 to-orange-600 hover:from-red-600 hover:to-orange-700 text-white py-4 px-6 rounded-2xl font-bold text-lg transition-all duration-200 transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3"
                            },
                                'ç¹¼çºŒ',
                                React.createElement(ArrowRight, { className: "w-5 h-5" })
                            )
                        ),
                        React.createElement('div', { className: "mt-8 text-center" },
                            React.createElement('div', { className: "text-sm text-gray-500" }, 'æ­¥é©Ÿ 1 / 6'),
                            React.createElement('div', { className: "w-full bg-gray-200 rounded-full h-2 mt-2" },
                                React.createElement('div', { className: "bg-red-500 h-2 rounded-full transition-all duration-300", style: {width: '16.67%'} })
                            )
                        )
                    )
                );
            }

            // Step 1: Gender
            if (currentStep === 1) {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-red-100 via-orange-50 to-yellow-100 flex items-center justify-center p-4" },
                    React.createElement('div', { className: "bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full border-2 border-red-200" },
                        React.createElement('div', { className: "text-center mb-8" },
                            React.createElement('div', { className: "flex justify-center mb-4" },
                                React.createElement('div', { className: "text-4xl" }, 'ğŸ‘¶')
                            ),
                            React.createElement('h1', { className: "text-3xl font-bold text-gray-800 mb-2" }, getStepTitle()),
                            React.createElement('p', { className: "text-gray-600" }, getStepSubtitle())
                        ),
                        React.createElement('div', { className: "space-y-4" },
                            [
                                { value: 'ç”·å­©', label: 'ç”·å­©', emoji: 'ğŸ‘¦' },
                                { value: 'å¥³å­©', label: 'å¥³å­©', emoji: 'ğŸ‘§' }
                            ].map((gender) =>
                                React.createElement('button', {
                                    key: gender.value,
                                    onClick: () => setFormData({...formData, gender: gender.value}),
                                    className: `w-full py-4 px-6 rounded-2xl border-2 transition-all duration-200 text-center font-bold text-lg flex items-center justify-center gap-3 ${
                                        formData.gender === gender.value
                                            ? 'border-red-500 bg-red-50 text-red-700'
                                            : 'border-gray-200 hover:border-gray-300 text-gray-600 hover:bg-gray-50'
                                    }`
                                },
                                    React.createElement('span', { className: "text-2xl" }, gender.emoji),
                                    gender.label
                                )
                            )
                        ),
                        React.createElement('div', { className: "flex gap-4 mt-8" },
                            React.createElement('button', {
                                onClick: prevStep,
                                className: "flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-6 rounded-2xl font-medium transition-all duration-200 flex items-center justify-center gap-2"
                            },
                                React.createElement(ArrowLeft, { className: "w-4 h-4" }),
                                'è¿”å›'
                            ),
                            React.createElement('button', {
                                onClick: nextStep,
                                disabled: !canProceed(),
                                className: "flex-2 bg-gradient-to-r from-red-500 to-orange-600 hover:from-red-600 hover:to-orange-700 text-white py-3 px-6 rounded-2xl font-bold transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                            },
                                'ç¹¼çºŒ',
                                React.createElement(ArrowRight, { className: "w-4 h-4" })
                            )
                        ),
                        React.createElement('div', { className: "mt-8 text-center" },
                            React.createElement('div', { className: "text-sm text-gray-500" }, 'æ­¥é©Ÿ 2 / 6'),
                            React.createElement('div', { className: "w-full bg-gray-200 rounded-full h-2 mt-2" },
                                React.createElement('div', { className: "bg-red-500 h-2 rounded-full transition-all duration-300", style: {width: '33.33%'} })
                            )
                        )
                    )
                );
            }

            // Step 2: Interests
            if (currentStep === 2) {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-red-100 via-orange-50 to-yellow-100 flex items-center justify-center p-4" },
                    React.createElement('div', { className: "bg-white rounded-3xl shadow-2xl p-8 max-w-lg w-full border-2 border-red-200" },
                        React.createElement('div', { className: "text-center mb-8" },
                            React.createElement('div', { className: "flex justify-center mb-4" },
                                React.createElement('div', { className: "text-4xl" }, 'â­')
                            ),
                            React.createElement('h1', { className: "text-2xl lg:text-3xl font-bold text-gray-800 mb-2" }, getStepTitle()),
                            React.createElement('p', { className: "text-gray-600" }, getStepSubtitle())
                        ),
                        React.createElement('div', { className: "grid grid-cols-2 gap-3 mb-8" },
                            interests.map((interest) =>
                                React.createElement('button', {
                                    key: interest,
                                    onClick: () => handleInterestToggle(interest),
                                    className: `py-3 px-4 rounded-xl border-2 transition-all duration-200 text-center font-medium text-sm ${
                                        formData.interests.includes(interest)
                                            ? 'border-red-500 bg-red-50 text-red-700'
                                            : 'border-gray-200 hover:border-gray-300 text-gray-600 hover:bg-gray-50'
                                    }`
                                },
                                    interest
                                )
                            )
                        ),
                        React.createElement('div', { className: "flex gap-4" },
                            React.createElement('button', {
                                onClick: prevStep,
                                className: "flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-6 rounded-2xl font-medium transition-all duration-200 flex items-center justify-center gap-2"
                            },
                                React.createElement(ArrowLeft, { className: "w-4 h-4" }),
                                'è¿”å›'
                            ),
                            React.createElement('button', {
                                onClick: nextStep,
                                disabled: !canProceed(),
                                className: "flex-2 bg-gradient-to-r from-red-500 to-orange-600 hover:from-red-600 hover:to-orange-700 text-white py-3 px-6 rounded-2xl font-bold transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                            },
                                'ç¹¼çºŒ',
                                React.createElement(ArrowRight, { className: "w-4 h-4" })
                            )
                        ),
                        React.createElement('div', { className: "mt-8 text-center" },
                            React.createElement('div', { className: "text-sm text-gray-500" }, 'æ­¥é©Ÿ 3 / 6'),
                            React.createElement('div', { className: "w-full bg-gray-200 rounded-full h-2 mt-2" },
                                React.createElement('div', { className: "bg-red-500 h-2 rounded-full transition-all duration-300", style: {width: '50%'} })
                            )
                        )
                    )
                );
            }

            // Step 3: Story Length
            if (currentStep === 3) {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-red-100 via-orange-50 to-yellow-100 flex items-center justify-center p-4" },
                    React.createElement('div', { className: "bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full border-2 border-red-200" },
                        React.createElement('div', { className: "text-center mb-8" },
                            React.createElement('div', { className: "flex justify-center mb-4" },
                                React.createElement('div', { className: "text-4xl" }, 'ğŸ“š')
                            ),
                            React.createElement('h1', { className: "text-2xl lg:text-3xl font-bold text-gray-800 mb-2" }, getStepTitle()),
                            React.createElement('p', { className: "text-gray-600" }, getStepSubtitle())
                        ),
                        React.createElement('div', { className: "space-y-3 mb-8" },
                            storyLengths.map((length) =>
                                React.createElement('button', {
                                    key: length.value,
                                    onClick: () => setFormData({...formData, length: length.value}),
                                    className: `w-full py-4 px-6 rounded-2xl border-2 transition-all duration-200 text-left font-medium flex items-center gap-4 ${
                                        formData.length === length.value
                                            ? 'border-red-500 bg-red-50 text-red-700'
                                            : 'border-gray-200 hover:border-gray-300 text-gray-600 hover:bg-gray-50'
                                    }`
                                },
                                    React.createElement('span', { className: "text-3xl" }, length.emoji),
                                    React.createElement('div', { className: "flex-1" },
                                        React.createElement('div', { className: "font-bold text-lg" }, length.label),
                                        React.createElement('div', { className: "text-sm opacity-70" }, length.desc),
                                        React.createElement('div', { className: "text-xs opacity-50 mt-1" }, length.chars)
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: "flex gap-4" },
                            React.createElement('button', {
                                onClick: prevStep,
                                className: "flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-6 rounded-2xl font-medium transition-all duration-200 flex items-center justify-center gap-2"
                            },
                                React.createElement(ArrowLeft, { className: "w-4 h-4" }),
                                'è¿”å›'
                            ),
                            React.createElement('button', {
                                onClick: nextStep,
                                disabled: !canProceed(),
                                className: "flex-2 bg-gradient-to-r from-red-500 to-orange-600 hover:from-red-600 hover:to-orange-700 text-white py-3 px-6 rounded-2xl font-bold transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                            },
                                'ç¹¼çºŒ',
                                React.createElement(ArrowRight, { className: "w-4 h-4" })
                            )
                        ),
                        React.createElement('div', { className: "mt-8 text-center" },
                            React.createElement('div', { className: "text-sm text-gray-500" }, 'æ­¥é©Ÿ 4 / 6'),
                            React.createElement('div', { className: "w-full bg-gray-200 rounded-full h-2 mt-2" },
                                React.createElement('div', { className: "bg-red-500 h-2 rounded-full transition-all duration-300", style: {width: '66.67%'} })
                            )
                        )
                    )
                );
            }

            // Step 4: Lesson
            if (currentStep === 4) {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-red-100 via-orange-50 to-yellow-100 flex items-center justify-center p-4" },
                    React.createElement('div', { className: "bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full border-2 border-red-200" },
                        React.createElement('div', { className: "text-center mb-8" },
                            React.createElement('div', { className: "flex justify-center mb-4" },
                                React.createElement('div', { className: "text-4xl" }, 'ğŸ’')
                            ),
                            React.createElement('h1', { className: "text-2xl lg:text-3xl font-bold text-gray-800 mb-2" }, getStepTitle()),
                            React.createElement('p', { className: "text-gray-600" }, getStepSubtitle())
                        ),
                        React.createElement('div', { className: "space-y-6" },
                            React.createElement('textarea', {
                                value: formData.lesson,
                                onChange: (e) => setFormData({...formData, lesson: e.target.value}),
                                placeholder: "ä¾‹å¦‚ï¼šå°ä»–äººå‹å–„ã€å˜—è©¦æ–°äº‹ç‰©ã€åˆ†äº«çš„é‡è¦æ€§ã€é¢å°ææ‡¼è¦å‹‡æ•¢...",
                                className: "w-full px-6 py-4 border-2 border-gray-200 rounded-2xl focus:border-red-500 focus:outline-none transition-colors resize-none h-32 text-lg",
                                autoFocus: true
                            }),
                            React.createElement('div', { className: "flex gap-4" },
                                React.createElement('button', {
                                    onClick: prevStep,
                                    className: "flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-6 rounded-2xl font-medium transition-all duration-200 flex items-center justify-center gap-2"
                                },
                                    React.createElement(ArrowLeft, { className: "w-4 h-4" }),
                                    'è¿”å›'
                                ),
                                React.createElement('button', {
                                    onClick: generateStory,
                                    disabled: !canProceed(),
                                    className: "flex-2 bg-gradient-to-r from-red-500 to-orange-600 hover:from-red-600 hover:to-orange-700 text-white py-3 px-6 rounded-2xl font-bold transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                },
                                    'å‰µä½œæ•…äº‹',
                                    React.createElement(Sparkles, { className: "w-4 h-4" })
                                )
                            )
                        ),
                        React.createElement('div', { className: "mt-8 text-center" },
                            React.createElement('div', { className: "text-sm text-gray-500" }, 'æ­¥é©Ÿ 5 / 6'),
                            React.createElement('div', { className: "w-full bg-gray-200 rounded-full h-2 mt-2" },
                                React.createElement('div', { className: "bg-red-500 h-2 rounded-full transition-all duration-300", style: {width: '83.33%'} })
                            )
                        )
                    )
                );
            }

            // Step 5: Loading
            if (currentStep === 5) {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-red-100 via-orange-50 to-yellow-100 flex items-center justify-center p-4" },
                    React.createElement('div', { className: "bg-white rounded-3xl shadow-2xl p-12 text-center max-w-md w-full border-2 border-red-200" },
                        React.createElement('div', { className: "animate-pulse mb-6" },
                            React.createElement('div', { className: "text-6xl" }, 'ğŸ®')
                        ),
                        React.createElement('h2', { className: "text-3xl font-bold text-gray-800 mb-4" }, getStepTitle()),
                        React.createElement('p', { className: "text-gray-600 mb-6" }, getStepSubtitle()),
                        React.createElement('div', { className: "flex justify-center" },
                            React.createElement(Loader2, { className: "w-8 h-8 text-red-500 animate-spin" })
                        )
                    )
                );
            }

            // Step 6: Story Display
            if (currentStep === 6) {
                return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-red-100 via-orange-50 to-yellow-100 p-4" },
                    React.createElement('div', { className: "max-w-4xl mx-auto" },
                        React.createElement('div', { className: "bg-white rounded-3xl shadow-2xl overflow-hidden border-2 border-red-200" },
                            React.createElement('div', { className: "bg-gradient-to-r from-red-500 to-orange-600 p-6" },
                                React.createElement('div', { className: "text-center" },
                                    React.createElement('h1', { className: "text-3xl font-bold text-white mb-2 flex items-center justify-center gap-3" },
                                        React.createElement(Book, { className: "w-8 h-8" }),
                                        storyData?.title || getStepTitle()
                                    ),
                                    React.createElement('p', { className: "text-red-100" }, getStepSubtitle())
                                )
                            ),
                            React.createElement('div', { className: "p-8" },
                                React.createElement('div', { className: "flex justify-center gap-4 mb-6" },
                                    React.createElement('button', {
                                        onClick: () => setShowPinyin(!showPinyin),
                                        className: `px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center gap-2 ${
                                            showPinyin 
                                                ? 'bg-blue-500 text-white' 
                                                : 'bg-gray-200 text-gray-600 hover:bg-gray-300'
                                        }`
                                    },
                                        showPinyin ? React.createElement(Eye, { className: "w-4 h-4" }) : React.createElement(EyeOff, { className: "w-4 h-4" }),
                                        'æ‹¼éŸ³ (Hanyu Pinyin)'
                                    ),
                                    React.createElement('button', {
                                        onClick: () => setShowZhuyin(!showZhuyin),
                                        className: `px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center gap-2 ${
                                            showZhuyin 
                                                ? 'bg-green-500 text-white' 
                                                : 'bg-gray-200 text-gray-600 hover:bg-gray-300'
                                        }`
                                    },
                                        showZhuyin ? React.createElement(Eye, { className: "w-4 h-4" }) : React.createElement(EyeOff, { className: "w-4 h-4" }),
                                        'æ³¨éŸ³ (Zhuyin)'
                                    )
                                ),
                                React.createElement('div', { className: "bg-gradient-to-r from-yellow-50 to-orange-50 rounded-2xl p-6 border-l-4 border-orange-300 mb-8" },
                                    React.createElement('div', { className: "space-y-6" },
                                        storyData?.story?.map((sentence, index) =>
                                            React.createElement('div', { key: index, className: "bg-white rounded-lg p-4 shadow-sm" },
                                                React.createElement('div', { className: "text-2xl font-bold text-gray-800 mb-2 leading-relaxed" },
                                                    sentence.chinese
                                                ),
                                                showPinyin && React.createElement('div', { className: "text-blue-600 font-medium mb-1 text-lg" },
                                    'ğŸ“ ', sentence.hanyu_pinyin
                                ),
                                                showZhuyin && React.createElement('div', { className: "text-green-600 font-medium text-lg" },
                                                    'ğŸ”¤ ', sentence.zhuyin
                                                )
                                            )
                                        ) || React.createElement('div', { className: "text-center text-gray-500 py-8" },
                                            React.createElement(Loader2, { className: "w-6 h-6 animate-spin mx-auto mb-2" }),
                                            'æ•…äº‹è¼‰å…¥ä¸­...'
                                        )
                                    )
                                ),
                                React.createElement('div', { className: "flex flex-col gap-4" },
                                    React.createElement('div', { className: "flex items-center justify-center gap-2 text-red-500 mb-4" },
                                        React.createElement(Star, { className: "w-5 h-5" }),
                                        React.createElement('span', { className: "text-sm font-medium" }, 'æ™šå®‰å¥½å¤¢ï¼'),
                                        React.createElement(Star, { className: "w-5 h-5" })
                                    ),
                                    React.createElement('button', {
                                        onClick: resetForm,
                                        className: "w-full bg-gradient-to-r from-red-500 to-orange-600 hover:from-red-600 hover:to-orange-700 text-white py-4 px-6 rounded-2xl font-bold text-lg transition-all duration-200 transform hover:scale-[1.02] flex items-center justify-center gap-3"
                                    },
                                        React.createElement(Sparkles, { className: "w-6 h-6" }),
                                        'å‰µä½œå¦ä¸€å€‹æ•…äº‹',
                                        React.createElement(Heart, { className: "w-6 h-6" })
                                    )
                                )
                            )
                        )
                    )
                );
            }

            return null;
        };

        const App = () => {
            return React.createElement(ChineseBedtimeStoryGenerator);
        };

        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>